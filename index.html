<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador de Gerenciamento de Mem√≥ria - UFAM</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8ec 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            padding: 30px;
        }

        header {
            margin-bottom: 30px;
        }

        h1 {
            color: #2c3e50;
            font-size: 2em;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #7f8c8d;
            font-size: 0.95em;
        }

        .tabs {
            display: flex;
            gap: 10px;
            border-bottom: 2px solid #e0e0e0;
            margin-bottom: 30px;
        }

        .tab {
            padding: 12px 24px;
            background: none;
            border: none;
            font-size: 1em;
            font-weight: 600;
            color: #7f8c8d;
            cursor: pointer;
            border-bottom: 4px solid transparent;
            transition: all 0.3s;
        }

        .tab:hover {
            color: #2c3e50;
        }

        .tab.active {
            color: #3498db;
            border-bottom-color: #3498db;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .info-box {
            background: #e8f4f8;
            border: 1px solid #b8dce8;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 25px;
        }

        .info-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            font-weight: 600;
            color: #1e5a7a;
        }

        .info-content {
            margin-top: 12px;
            color: #2c5f7a;
            font-size: 0.9em;
            line-height: 1.6;
            display: none;
        }

        .info-content.show {
            display: block;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
        }

        .card {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .card h3 {
            font-size: 1.2em;
            margin-bottom: 20px;
            color: #2c3e50;
        }

        .control-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            font-size: 0.9em;
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }

        select, input[type="range"] {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 0.95em;
        }

        input[type="range"] {
            padding: 0;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        button {
            flex: 1;
            padding: 10px 16px;
            border: none;
            border-radius: 6px;
            font-size: 0.9em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background: #2980b9;
        }

        .btn-success {
            background: #27ae60;
            color: white;
        }

        .btn-success:hover:not(:disabled) {
            background: #229954;
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
        }

        .btn-danger:hover:not(:disabled) {
            background: #c0392b;
        }

        .btn-secondary {
            background: #95a5a6;
            color: white;
        }

        .btn-secondary:hover:not(:disabled) {
            background: #7f8c8d;
        }

        .btn-warning {
            background: #f39c12;
            color: white;
        }

        .btn-warning:hover:not(:disabled) {
            background: #e67e22;
        }

        .stats-box {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            text-align: center;
        }

        .stat-item {
            padding: 10px;
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.85em;
            color: #7f8c8d;
        }

        .memory-frame {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }

        .frame-label {
            width: 80px;
            font-size: 0.9em;
            font-weight: 600;
        }

        .frame-slot {
            flex: 1;
            height: 50px;
            border: 2px solid #ddd;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1em;
            font-weight: bold;
            transition: all 0.3s;
        }

        .frame-slot.filled {
            background: #3498db;
            color: white;
            border-color: #2980b9;
        }

        .frame-slot.empty {
            background: #f8f9fa;
            color: #bdc3c7;
        }

        .page-sequence {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 15px;
        }

        .page-item {
            width: 45px;
            height: 45px;
            border: 2px solid;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.1em;
        }

        .page-item.pending {
            background: #ecf0f1;
            border-color: #bdc3c7;
            color: #7f8c8d;
        }

        .page-item.current {
            background: #f1c40f;
            border-color: #f39c12;
            animation: pulse 1s infinite;
        }

        .page-item.hit {
            background: #27ae60;
            border-color: #229954;
            color: white;
        }

        .page-item.fault {
            background: #e74c3c;
            border-color: #c0392b;
            color: white;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .segment-list, .process-list {
            max-height: 450px;
            overflow-y: auto;
        }

        .segment-item, .process-item {
            padding: 15px;
            border: 2px solid;
            border-radius: 8px;
            margin-bottom: 12px;
        }

        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .item-title {
            font-weight: bold;
            font-size: 1.1em;
        }

        .item-info {
            font-size: 0.85em;
            margin-bottom: 10px;
            color: #555;
        }

        .memory-grid {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 8px;
            margin-bottom: 20px;
        }

        .memory-block {
            height: 70px;
            border: 2px solid;
            border-radius: 6px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9em;
        }

        .memory-block.empty {
            background: #f8f9fa;
            border-color: #ddd;
            color: #bdc3c7;
        }

        .block-index {
            font-size: 0.7em;
            color: #7f8c8d;
            margin-bottom: 4px;
        }

        .ram-grid {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 8px;
        }

        .progress-bar {
            width: 100%;
            height: 12px;
            background: #ecf0f1;
            border-radius: 6px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress-fill {
            height: 100%;
            background: #27ae60;
            transition: width 0.3s;
        }

        .swap-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .swap-item {
            padding: 20px;
            border: 2px solid;
            border-radius: 8px;
            text-align: center;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
            background: #f8f9fa;
            border-radius: 8px;
        }

        footer {
            margin-top: 40px;
            padding-top: 25px;
            border-top: 1px solid #e0e0e0;
            text-align: center;
            color: #7f8c8d;
            font-size: 0.9em;
        }

        footer p {
            margin: 5px 0;
        }

        .grid-3 {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }

        .stat-card {
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }

        @media (max-width: 768px) {
            .grid-2 {
                grid-template-columns: 1fr;
            }
            
            .memory-grid, .ram-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üñ•Ô∏è Simulador de Gerenciamento de Mem√≥ria</h1>
            <p class="subtitle">UFAM - ICET | Sistemas Operacionais | Grupo 4</p>
        </header>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('paging')">Pagina√ß√£o</button>
            <button class="tab" onclick="switchTab('segmentation')">Segmenta√ß√£o</button>
            <button class="tab" onclick="switchTab('swapping')">Swapping</button>
        </div>

        <!-- TAB: PAGINA√á√ÉO -->
        <div id="paging" class="tab-content active">
            <div class="info-box">
                <div class="info-header" onclick="toggleInfo('paging-info')">
                    <span>‚ÑπÔ∏è O que √© Pagina√ß√£o?</span>
                    <span id="paging-info-icon">‚ñº</span>
                </div>
                <div id="paging-info" class="info-content">
                    <p style="margin-bottom: 10px;">
                        A pagina√ß√£o divide a mem√≥ria em blocos de tamanho fixo chamados <strong>p√°ginas</strong> (mem√≥ria l√≥gica) 
                        e <strong>frames</strong> (mem√≥ria f√≠sica). Quando um processo precisa de uma p√°gina que n√£o est√° na mem√≥ria, 
                        ocorre um <strong>page fault</strong> e o sistema deve buscar a p√°gina.
                    </p>
                    <p><strong>Algoritmos de Substitui√ß√£o:</strong></p>
                    <ul style="margin-left: 20px; margin-top: 5px;">
                        <li><strong>FIFO:</strong> Remove a p√°gina mais antiga (primeira a entrar)</li>
                        <li><strong>LRU:</strong> Remove a p√°gina menos recentemente usada</li>
                        <li><strong>OPT:</strong> Remove a p√°gina que ser√° usada mais tarde (√≥timo te√≥rico)</li>
                    </ul>
                </div>
            </div>

            <div class="grid-2">
                <div class="card">
                    <h3>‚öôÔ∏è Controles</h3>
                    
                    <div class="control-group">
                        <label>Algoritmo de Substitui√ß√£o</label>
                        <select id="algorithm" onchange="resetPaging()">
                            <option value="FIFO">FIFO (First In First Out)</option>
                            <option value="LRU">LRU (Least Recently Used)</option>
                            <option value="OPT">OPT (Optimal)</option>
                        </select>
                    </div>

                    <div class="control-group">
                        <label>N√∫mero de Frames: <span id="frames-value">4</span></label>
                        <input type="range" id="page-frames" min="2" max="6" value="4" oninput="updateFrames(this.value)">
                    </div>

                    <div class="control-group">
                        <label>Velocidade: <span id="speed-value">1000</span>ms</label>
                        <input type="range" id="speed" min="200" max="2000" step="200" value="1000" oninput="updateSpeed(this.value)">
                    </div>

                    <div class="button-group">
                        <button class="btn-primary" onclick="addRandomPage()">‚ûï P√°gina Aleat√≥ria</button>
                        <button class="btn-success" onclick="addDefaultSequence()">üìã Sequ√™ncia Padr√£o</button>
                    </div>

                    <div class="button-group">
                        <button class="btn-warning" id="play-btn" onclick="togglePlay()">‚ñ∂Ô∏è Executar</button>
                        <button class="btn-primary" onclick="stepPage()" id="step-btn">‚è≠Ô∏è Passo</button>
                        <button class="btn-secondary" onclick="resetPaging()">üîÑ Reset</button>
                    </div>

                    <div class="stats-box">
                        <div class="stats-grid">
                            <div class="stat-item">
                                <div class="stat-value" style="color: #e74c3c;" id="page-faults">0</div>
                                <div class="stat-label">Page Faults</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" style="color: #27ae60;" id="page-hits">0</div>
                                <div class="stat-label">Page Hits</div>
                            </div>
                        </div>
                        <div id="hit-rate" style="text-align: center; margin-top: 15px; display: none;">
                            <div class="stat-label">Taxa de Acerto</div>
                            <div class="stat-value" style="color: #3498db; font-size: 1.5em;" id="hit-rate-value">0%</div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h3>üíæ Mem√≥ria F√≠sica (Frames)</h3>
                    <div id="memory-frames"></div>

                    <div style="margin-top: 25px;">
                        <h4 style="margin-bottom: 12px;">Sequ√™ncia de P√°ginas:</h4>
                        <div id="page-sequence" class="page-sequence"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB: SEGMENTA√á√ÉO -->
        <div id="segmentation" class="tab-content">
            <div class="info-box">
                <div class="info-header" onclick="toggleInfo('seg-info')">
                    <span>‚ÑπÔ∏è O que √© Segmenta√ß√£o?</span>
                    <span id="seg-info-icon">‚ñº</span>
                </div>
                <div id="seg-info" class="info-content">
                    <p style="margin-bottom: 10px;">
                        A segmenta√ß√£o divide a mem√≥ria em blocos de tamanho <strong>vari√°vel</strong> chamados segmentos, 
                        que correspondem a unidades l√≥gicas do programa (c√≥digo, dados, pilha). Cada segmento tem uma 
                        base (endere√ßo inicial) e um limite (tamanho).
                    </p>
                    <p>
                        <strong>Vantagens:</strong> Prote√ß√£o l√≥gica, compartilhamento facilitado<br>
                        <strong>Desafios:</strong> Fragmenta√ß√£o externa, gerenciamento complexo
                    </p>
                </div>
            </div>

            <div class="grid-2">
                <div class="card">
                    <h3>üì¶ Segmentos</h3>
                    <button class="btn-primary" onclick="addSegment()" style="width: 100%; margin-bottom: 15px;">
                        ‚ûï Criar Segmento
                    </button>
                    <div id="segment-list" class="segment-list"></div>
                </div>

                <div class="card">
                    <h3>üíæ Mem√≥ria F√≠sica</h3>
                    <div id="segment-memory" class="memory-grid"></div>
                    
                    <div class="stats-box">
                        <h4 style="margin-bottom: 10px;">üìä Estat√≠sticas:</h4>
                        <div style="font-size: 0.9em;">
                            <div style="margin-bottom: 8px;">
                                <span style="color: #7f8c8d;">Blocos Ocupados:</span>
                                <strong id="seg-occupied">0/16</strong>
                            </div>
                            <div>
                                <span style="color: #7f8c8d;">Fragmenta√ß√£o:</span>
                                <strong id="seg-fragmentation">0 buracos</strong>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB: SWAPPING -->
        <div id="swapping" class="tab-content">
            <div class="info-box">
                <div class="info-header" onclick="toggleInfo('swap-info')">
                    <span>‚ÑπÔ∏è O que √© Swapping?</span>
                    <span id="swap-info-icon">‚ñº</span>
                </div>
                <div id="swap-info" class="info-content">
                    <p style="margin-bottom: 10px;">
                        Swapping √© uma t√©cnica de gerenciamento de mem√≥ria que move processos inteiros entre a 
                        <strong>mem√≥ria principal (RAM)</strong> e o <strong>espa√ßo de swap (disco)</strong>. 
                        Quando a RAM est√° cheia, processos inativos s√£o movidos para o disco para liberar espa√ßo.
                    </p>
                    <p>
                        <strong>Swap In:</strong> Trazer processo do disco para RAM<br>
                        <strong>Swap Out:</strong> Mover processo da RAM para disco<br>
                        <strong>Desafio:</strong> Opera√ß√µes de I/O s√£o lentas
                    </p>
                </div>
            </div>

            <div class="grid-2">
                <div class="card">
                    <h3>‚ö° Processos</h3>
                    <button class="btn-primary" onclick="addProcess()" style="width: 100%; margin-bottom: 15px;">
                        ‚ûï Criar Processo
                    </button>
                    <div id="process-list" class="process-list"></div>
                </div>

                <div class="card">
                    <h3>üíæ RAM (Mem√≥ria Principal)</h3>
                    <div id="ram-memory" class="ram-grid"></div>
                    
                    <div class="stats-box" style="background: #e8f8f5;">
                        <div style="font-size: 0.9em;">
                            <span style="color: #555;">Utiliza√ß√£o da RAM:</span>
                            <strong id="ram-usage">0/8 blocos</strong>
                        </div>
                        <div class="progress-bar">
                            <div id="ram-progress" class="progress-fill" style="width: 0%"></div>
                        </div>
                    </div>

                    <h3 style="margin-top: 25px;">üíø Espa√ßo de SWAP (Disco)</h3>
                    <div id="swap-space"></div>

                    <div class="stats-box" style="background: #fff3e0; margin-top: 15px;">
                        <div style="font-size: 0.9em;">
                            <span style="color: #555;">Processos em SWAP:</span>
                            <strong id="swap-count">0</strong>
                        </div>
                    </div>

                    <h3 style="margin-top: 25px;">üìä Estat√≠sticas do Sistema</h3>
                    <div class="grid-3">
                        <div class="stat-card" style="background: #e8f4f8;">
                            <div class="stat-value" style="color: #3498db; font-size: 1.8em;" id="proc-ram">0</div>
                            <div class="stat-label">Em RAM</div>
                        </div>
                        <div class="stat-card" style="background: #fff3e0;">
                            <div class="stat-value" style="color: #f39c12; font-size: 1.8em;" id="proc-swap">0</div>
                            <div class="stat-label">Em SWAP</div>
                        </div>
                        <div class="stat-card" style="background: #f8f9fa;">
                            <div class="stat-value" style="color: #95a5a6; font-size: 1.8em;" id="proc-disk">0</div>
                            <div class="stat-label">Em Disco</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <footer>
            <p><strong>Grupo 4:</strong> Felipe, Nadia, Olivie, Marcos Gabriel | <strong>Professor:</strong> Rallyson Ferreira</p>
            <p>Trabalho Pr√°tico de Sistemas Operacionais - UFAM/ICET 2024</p>
        </footer>
    </div>

    <script>
        // Estado Global
        let state = {
            paging: {
                pages: [],
                memory: [],
                frames: 4,
                algorithm: 'FIFO',
                currentIndex: 0,
                pageFaults: 0,
                pageHits: 0,
                history: [],
                playing: false,
                speed: 1000
            },
            segmentation: {
                segments: [],
                memory: Array(16).fill(null),
                nextId: 1
            },
            swapping: {
                processes: [],
                ram: Array(8).fill(null),
                swap: [],
                nextId: 1
            }
        };

        const colors = ['#3498db', '#27ae60', '#9b59b6', '#f1c40f', '#e74c3c', '#1abc9c'];

        // Fun√ß√µes de Navega√ß√£o
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
            
            if (tabName === 'paging') renderPaging();
            if (tabName === 'segmentation') renderSegmentation();
            if (tabName === 'swapping') renderSwapping();
        }

        function toggleInfo(id) {
            const content = document.getElementById(id);
            const icon = document.getElementById(id + '-icon');
            content.classList.toggle('show');
            icon.textContent = content.classList.contains('show') ? '‚ñ≤' : '‚ñº';
        }

        // ============ PAGINA√á√ÉO ============
        function updateFrames(value) {
            state.paging.frames = parseInt(value);
            document.getElementById('frames-value').textContent = value;
            resetPaging();
        }

        function updateSpeed(value) {
            state.paging.speed = parseInt(value);
            document.getElementById('speed-value').textContent = value;
        }

        function addRandomPage() {
            const page = Math.floor(Math.random() * 10);
            state.paging.pages.push(page);
            renderPaging();
        }

        function addDefaultSequence() {
            state.paging.pages = [1, 2, 3, 4, 1, 2, 5, 1, 2, 3, 4, 5];
            resetPaging();
        }

        function resetPaging() {
            state.paging.algorithm = document.getElementById('algorithm').value;
            state.paging.memory = [];
            state.paging.currentIndex = 0;
            state.paging.pageFaults = 0;
            state.paging.pageHits = 0;
            state.paging.history = [];
            state.paging.playing = false;
            renderPaging();
        }

        function togglePlay() {
            state.paging.playing = !state.paging.playing;
            document.getElementById('play-btn').innerHTML = state.paging.playing ? '‚è∏Ô∏è Pausar' : '‚ñ∂Ô∏è Executar';
            if (state.paging.playing) autoPlay();
        }

        function autoPlay() {
            if (!state.paging.playing) return;
            if (state.paging.currentIndex >= state.paging.pages.length) {
                state.paging.playing = false;
                document.getElementById('play-btn').innerHTML = '‚ñ∂Ô∏è Executar';
                return;
            }
            stepPage();
            setTimeout(autoPlay, state.paging.speed);
        }

        function stepPage() {
            if (state.paging.currentIndex >= state.paging.pages.length) return;

            const page = state.paging.pages[state.paging.currentIndex];
            let fault = false;

            const existing = state.paging.memory.find(p => p.page === page);
            
            if (existing) {
                state.paging.pageHits++;
                if (state.paging.algorithm === 'LRU') {
                    existing.lastUsed = state.paging.currentIndex;
                }
            } else {
                state.paging.pageFaults++;
                fault = true;

                if (state.paging.memory.length < state.paging.frames) {
                    state.paging.memory.push({
                        page,
                        loadedAt: state.paging.currentIndex,
                        lastUsed: state.paging.currentIndex
                    });
                } else {
                    if (state.paging.algorithm === 'FIFO') {
                        state.paging.memory.shift();
                        state.paging.memory.push({
                            page,
                            loadedAt: state.paging.currentIndex,
                            lastUsed: state.paging.currentIndex
                        });
                    } else if (state.paging.algorithm === 'LRU') {
                        let lruIdx = 0;
                        let minUsed = state.paging.memory[0].lastUsed;
                        for (let i = 1; i < state.paging.memory.length; i++) {
                            if (state.paging.memory[i].lastUsed < minUsed) {
                                minUsed = state.paging.memory[i].lastUsed;
                                lruIdx = i;
                            }
                        }
                        state.paging.memory[lruIdx] = {
                            page,
                            loadedAt: state.paging.currentIndex,
                            lastUsed: state.paging.currentIndex
                        };
                    } else if (state.paging.algorithm === 'OPT') {
                        let replaceIdx = 0;
                        let farthest = -1;
                        for (let i = 0; i < state.paging.memory.length; i++) {
                            const futurePages = state.paging.pages.slice(state.paging.currentIndex + 1);
                            let nextUse = futurePages.indexOf(state.paging.memory[i].page);
                            if (nextUse === -1) nextUse = Infinity;
                            if (nextUse > farthest) {
                                farthest = nextUse;
                                replaceIdx = i;
                            }
                        }
                        state.paging.memory[replaceIdx] = {
                            page,
                            loadedAt: state.paging.currentIndex,
                            lastUsed: state.paging.currentIndex
                        };
                    }
                }
            }

            state.paging.history.push({ fault });
            state.paging.currentIndex++;
            renderPaging();
        }

        function renderPaging() {
            // Atualizar frames
            const framesHtml = Array(state.paging.frames).fill(0).map((_, idx) => {
                const frame = state.paging.memory[idx];
                return `
                    <div class="memory-frame">
                        <div class="frame-label">Frame ${idx}</div>
                        <div class="frame-slot ${frame ? 'filled' : 'empty'}">
                            ${frame ? 'P' + frame.page : 'Vazio'}
                        </div>
                    </div>
                `;
            }).join('');
            document.getElementById('memory-frames').innerHTML = framesHtml;

            // Atualizar sequ√™ncia de p√°ginas
            const sequenceHtml = state.paging.pages.length > 0 
                ? state.paging.pages.map((page, idx) => {
                    let className = 'pending';
                    if (idx < state.paging.currentIndex) {
                        className = state.paging.history[idx].fault ? 'fault' : 'hit';
                    } else if (idx === state.paging.currentIndex) {
                        className = 'current';
                    }
                    return `<div class="page-item ${className}">${page}</div>`;
                }).join('')
                : '<div style="color: #7f8c8d; font-size: 0.9em;">Adicione p√°ginas para come√ßar a simula√ß√£o</div>';
            document.getElementById('page-sequence').innerHTML = sequenceHtml;

            // Atualizar estat√≠sticas
            document.getElementById('page-faults').textContent = state.paging.pageFaults;
            document.getElementById('page-hits').textContent = state.paging.pageHits;
            
            const total = state.paging.pageFaults + state.paging.pageHits;
            if (total > 0) {
                const hitRate = ((state.paging.pageHits / total) * 100).toFixed(1);
                document.getElementById('hit-rate').style.display = 'block';
                document.getElementById('hit-rate-value').textContent = hitRate + '%';
            } else {
                document.getElementById('hit-rate').style.display = 'none';
            }

            // Atualizar bot√µes
            const hasPages = state.paging.pages.length > 0;
            const canStep = hasPages && state.paging.currentIndex < state.paging.pages.length;
            document.getElementById('play-btn').disabled = !canStep;
            document.getElementById('step-btn').disabled = !canStep;
        }

        // ============ SEGMENTA√á√ÉO ============
        function addSegment() {
            const sizes = [2, 3, 4];
            const size = sizes[Math.floor(Math.random() * sizes.length)];
            const color = colors[state.segmentation.nextId % colors.length];
            
            state.segmentation.segments.push({
                id: state.segmentation.nextId,
                size,
                color,
                allocated: false,
                base: null
            });
            state.segmentation.nextId++;
            renderSegmentation();
        }

        function allocateSegment(id) {
            const segment = state.segmentation.segments.find(s => s.id === id);
            if (!segment || segment.allocated) return;

            // First Fit
            let base = -1;
            for (let i = 0; i <= state.segmentation.memory.length - segment.size; i++) {
                let fits = true;
                for (let j = 0; j < segment.size; j++) {
                    if (state.segmentation.memory[i + j] !== null) {
                        fits = false;
                        break;
                    }
                }
                if (fits) {
                    base = i;
                    break;
                }
            }

            if (base !== -1) {
                for (let i = 0; i < segment.size; i++) {
                    state.segmentation.memory[base + i] = id;
                }
                segment.allocated = true;
                segment.base = base;
                renderSegmentation();
            } else {
                alert('N√£o h√° espa√ßo cont√≠guo suficiente na mem√≥ria!');
            }
        }

        function deallocateSegment(id) {
            state.segmentation.memory = state.segmentation.memory.map(slot => 
                slot === id ? null : slot
            );
            const segment = state.segmentation.segments.find(s => s.id === id);
            if (segment) {
                segment.allocated = false;
                segment.base = null;
            }
            renderSegmentation();
        }

        function removeSegment(id) {
            deallocateSegment(id);
            state.segmentation.segments = state.segmentation.segments.filter(s => s.id !== id);
            renderSegmentation();
        }

        function renderSegmentation() {
            // Renderizar lista de segmentos
            const segmentsHtml = state.segmentation.segments.length > 0
                ? state.segmentation.segments.map(seg => `
                    <div class="segment-item" style="border-color: ${seg.color}; background: ${seg.color}20;">
                        <div class="item-header">
                            <span class="item-title">Segmento ${seg.id}</span>
                            <button class="btn-danger" onclick="removeSegment(${seg.id})" 
                                    style="padding: 5px 10px; font-size: 0.85em;">üóëÔ∏è</button>
                        </div>
                        <div class="item-info">
                            Tamanho: ${seg.size} blocos
                            ${seg.allocated ? `<br>Base: ${seg.base}` : ''}
                        </div>
                        ${!seg.allocated 
                            ? `<button class="btn-success" onclick="allocateSegment(${seg.id})" 
                                      style="width: 100%; padding: 8px;">Alocar</button>`
                            : `<button class="btn-danger" onclick="deallocateSegment(${seg.id})" 
                                      style="width: 100%; padding: 8px;">Liberar</button>`
                        }
                    </div>
                `).join('')
                : '<div class="empty-state">Nenhum segmento criado</div>';
            document.getElementById('segment-list').innerHTML = segmentsHtml;

            // Renderizar mem√≥ria
            const memoryHtml = state.segmentation.memory.map((slot, idx) => {
                const segment = state.segmentation.segments.find(s => s.id === slot);
                return `
                    <div class="memory-block ${segment ? '' : 'empty'}" 
                         style="${segment ? `background: ${segment.color}70; border-color: ${segment.color};` : ''}">
                        <div class="block-index">${idx}</div>
                        <div>${segment ? 'S' + segment.id : '‚Äî'}</div>
                    </div>
                `;
            }).join('');
            document.getElementById('segment-memory').innerHTML = memoryHtml;

            // Estat√≠sticas
            const occupied = state.segmentation.memory.filter(s => s !== null).length;
            document.getElementById('seg-occupied').textContent = `${occupied}/${state.segmentation.memory.length}`;
            
            // Calcular fragmenta√ß√£o (n√∫mero de buracos)
            let holes = 0;
            let inHole = false;
            state.segmentation.memory.forEach(slot => {
                if (slot === null && !inHole) {
                    holes++;
                    inHole = true;
                } else if (slot !== null) {
                    inHole = false;
                }
            });
            document.getElementById('seg-fragmentation').textContent = `${holes} buraco${holes !== 1 ? 's' : ''}`;
        }

        // ============ SWAPPING ============
        function addProcess() {
            const sizes = [1, 2, 3];
            const size = sizes[Math.floor(Math.random() * sizes.length)];
            const color = colors[state.swapping.nextId % colors.length];
            
            state.swapping.processes.push({
                id: state.swapping.nextId,
                size,
                color,
                location: 'disk',
                ramBase: null
            });
            state.swapping.nextId++;
            renderSwapping();
        }

        function swapIn(id) {
            const process = state.swapping.processes.find(p => p.id === id);
            if (!process || process.location === 'ram') return;

            // Encontrar espa√ßo na RAM
            let base = -1;
            for (let i = 0; i <= state.swapping.ram.length - process.size; i++) {
                let fits = true;
                for (let j = 0; j < process.size; j++) {
                    if (state.swapping.ram[i + j] !== null) {
                        fits = false;
                        break;
                    }
                }
                if (fits) {
                    base = i;
                    break;
                }
            }

            if (base !== -1) {
                for (let i = 0; i < process.size; i++) {
                    state.swapping.ram[base + i] = id;
                }
                state.swapping.swap = state.swapping.swap.filter(pid => pid !== id);
                process.location = 'ram';
                process.ramBase = base;
                renderSwapping();
            } else {
                alert('N√£o h√° espa√ßo suficiente na RAM!');
            }
        }

        function swapOut(id) {
            state.swapping.ram = state.swapping.ram.map(slot => slot === id ? null : slot);
            state.swapping.swap.push(id);
            const process = state.swapping.processes.find(p => p.id === id);
            if (process) {
                process.location = 'swap';
                process.ramBase = null;
            }
            renderSwapping();
        }

        function removeProcess(id) {
            const process = state.swapping.processes.find(p => p.id === id);
            if (process && process.location === 'ram') {
                swapOut(id);
            }
            state.swapping.swap = state.swapping.swap.filter(pid => pid !== id);
            state.swapping.processes = state.swapping.processes.filter(p => p.id !== id);
            renderSwapping();
        }

        function renderSwapping() {
            // Renderizar lista de processos
            const processesHtml = state.swapping.processes.length > 0
                ? state.swapping.processes.map(proc => {
                    let locationEmoji = '‚ö™';
                    let locationText = 'Disco';
                    if (proc.location === 'ram') {
                        locationEmoji = 'üü¢';
                        locationText = 'RAM';
                    } else if (proc.location === 'swap') {
                        locationEmoji = 'üî¥';
                        locationText = 'SWAP';
                    }

                    let actionButton = '';
                    if (proc.location === 'disk' || proc.location === 'swap') {
                        actionButton = `<button class="btn-success" onclick="swapIn(${proc.id})" 
                                               style="width: 100%; padding: 8px;">Swap In</button>`;
                    } else if (proc.location === 'ram') {
                        actionButton = `<button class="btn-warning" onclick="swapOut(${proc.id})" 
                                               style="width: 100%; padding: 8px;">Swap Out</button>`;
                    }

                    return `
                        <div class="process-item" style="border-color: ${proc.color}; background: ${proc.color}20;">
                            <div class="item-header">
                                <span class="item-title">Processo P${proc.id}</span>
                                <button class="btn-danger" onclick="removeProcess(${proc.id})" 
                                        style="padding: 5px 10px; font-size: 0.85em;">üóëÔ∏è</button>
                            </div>
                            <div class="item-info">
                                Tamanho: ${proc.size} bloco${proc.size > 1 ? 's' : ''}<br>
                                Local: ${locationEmoji} ${locationText}
                            </div>
                            ${actionButton}
                        </div>
                    `;
                }).join('')
                : '<div class="empty-state">Nenhum processo criado</div>';
            document.getElementById('process-list').innerHTML = processesHtml;

            // Renderizar RAM
            const ramHtml = state.swapping.ram.map((slot, idx) => {
                const process = state.swapping.processes.find(p => p.id === slot);
                return `
                    <div class="memory-block ${process ? '' : 'empty'}" 
                         style="${process ? `background: ${process.color}70; border-color: ${process.color};` : ''}">
                        <div class="block-index">${idx}</div>
                        <div>${process ? 'P' + process.id : '‚Äî'}</div>
                    </div>
                `;
            }).join('');
            document.getElementById('ram-memory').innerHTML = ramHtml;

            // Estat√≠sticas RAM
            const ramOccupied = state.swapping.ram.filter(s => s !== null).length;
            document.getElementById('ram-usage').textContent = `${ramOccupied}/${state.swapping.ram.length} blocos`;
            const ramPercent = (ramOccupied / state.swapping.ram.length) * 100;
            document.getElementById('ram-progress').style.width = ramPercent + '%';

            // Renderizar SWAP
            const swapHtml = state.swapping.swap.length > 0
                ? state.swapping.swap.map(procId => {
                    const process = state.swapping.processes.find(p => p.id === procId);
                    return `
                        <div class="swap-item" style="border-color: ${process.color}; background: ${process.color}30;">
                            <div style="font-weight: bold; font-size: 1.3em; margin-bottom: 5px;">P${procId}</div>
                            <div style="font-size: 0.85em; color: #555;">${process.size} bloco${process.size > 1 ? 's' : ''}</div>
                        </div>
                    `;
                }).join('')
                : '<div class="empty-state">Espa√ßo de swap vazio</div>';
            document.getElementById('swap-space').innerHTML = swapHtml;

            // Estat√≠sticas gerais
            document.getElementById('swap-count').textContent = state.swapping.swap.length;
            document.getElementById('proc-ram').textContent = state.swapping.processes.filter(p => p.location === 'ram').length;
            document.getElementById('proc-swap').textContent = state.swapping.swap.length;
            document.getElementById('proc-disk').textContent = state.swapping.processes.filter(p => p.location === 'disk').length;
        }

        // Inicializa√ß√£o
        renderPaging();
        renderSegmentation();
        renderSwapping();
    </script>
</body>
</html>
